

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tastypie Cookbook &mdash; Tastypie v0.9.7-beta documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.9.7-beta',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Tastypie v0.9.7-beta documentation" href="index.html" />
    <link rel="next" title="Debugging Tastypie" href="debugging.html" />
    <link rel="prev" title="Throttling" href="throttling.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="debugging.html" title="Debugging Tastypie"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="throttling.html" title="Throttling"
             accesskey="P">previous</a> |</li>
        <li><a href="toc.html">Tastypie v0.9.7-beta documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="tastypie-cookbook">
<span id="ref-cookbook"></span><h1>Tastypie Cookbook<a class="headerlink" href="#tastypie-cookbook" title="Permalink to this headline">¶</a></h1>
<div class="section" id="adding-custom-values">
<h2>Adding Custom Values<a class="headerlink" href="#adding-custom-values" title="Permalink to this headline">¶</a></h2>
<p>You might encounter cases where you wish to include additional data in a
response which is not obtained from a field or method on your model. You can
easily extend the <tt class="xref py py-meth docutils literal"><span class="pre">dehydrate()</span></tt> method to
provide additional values:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyModelResource</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="n">MyModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">dehydrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;custom_field&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Whatever you want&quot;</span>
        <span class="k">return</span> <span class="n">bundle</span>
</pre></div>
</div>
</div>
<div class="section" id="using-your-resource-in-regular-views">
<h2>Using Your <tt class="docutils literal"><span class="pre">Resource</span></tt> In Regular Views<a class="headerlink" href="#using-your-resource-in-regular-views" title="Permalink to this headline">¶</a></h2>
<p>In addition to using your resource classes to power the API, you can also use
them to write other parts of your application, such as your views. For
instance, if you wanted to encode user information in the page for some
Javascript&#8217;s use, you could do the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># views.py</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render_to_response</span>
<span class="kn">from</span> <span class="nn">myapp.api.resources</span> <span class="kn">import</span> <span class="n">UserResource</span>


<span class="k">def</span> <span class="nf">user_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>
    <span class="n">ur</span> <span class="o">=</span> <span class="n">UserResource</span><span class="p">()</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">ur</span><span class="o">.</span><span class="n">obj_get_detail</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span>

    <span class="c"># Other things get prepped to go into the context then...</span>

    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;myapp/user_detail.html&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="c"># Other things here.</span>
        <span class="s">&quot;user_json&quot;</span><span class="p">:</span> <span class="n">ur</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">ur</span><span class="o">.</span><span class="n">full_dehydrate</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">user</span><span class="p">),</span> <span class="s">&#39;application/json&#39;</span><span class="p">),</span>
    <span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="using-non-pk-data-for-your-urls">
<h2>Using Non-PK Data For Your URLs<a class="headerlink" href="#using-non-pk-data-for-your-urls" title="Permalink to this headline">¶</a></h2>
<p>By convention, <tt class="docutils literal"><span class="pre">ModelResource``s</span> <span class="pre">usually</span> <span class="pre">expose</span> <span class="pre">the</span> <span class="pre">detail</span> <span class="pre">endpoints</span> <span class="pre">utilizing</span>
<span class="pre">the</span> <span class="pre">primary</span> <span class="pre">key</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">``Model</span></tt> they represent. However, this is not a strict
requirement. Each URL can take other named URLconf parameters that can be used
for the lookup.</p>
<p>For example, if you want to expose <tt class="docutils literal"><span class="pre">User</span></tt> resources by username, you can do
something like the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># myapp/api/resources.py</span>
<span class="k">class</span> <span class="nc">UserResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">override_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&quot;^(?P&lt;resource_name&gt;</span><span class="si">%s</span><span class="s">)/(?P&lt;username&gt;[\w\d_.-]+)/$&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="s">&#39;dispatch_detail&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;api_dispatch_detail&quot;</span><span class="p">),</span>
        <span class="p">]</span>
</pre></div>
</div>
<p>The added URLconf matches before the standard URLconf included by default &amp;
matches on the username provided in the URL.</p>
<p>You can also do &#8220;nested resources&#8221; (resources within another related resource)
by lightly overriding the <tt class="docutils literal"><span class="pre">dispatch</span></tt> method in a similar way:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># myapp/api/resources.py</span>
<span class="k">class</span> <span class="nc">EntryResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">UserResource</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s">&#39;entry&#39;</span>

    <span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_type</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;username&#39;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;user&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">EntryResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">request_type</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="c"># urls.py</span>
<span class="kn">from</span> <span class="nn">django.conf.urls.defaults</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">myapp.api</span> <span class="kn">import</span> <span class="n">EntryResource</span>

<span class="n">entry_resource</span> <span class="o">=</span> <span class="n">EntryResource</span><span class="p">()</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="c"># The normal jazz here, then...</span>
    <span class="p">(</span><span class="s">r&#39;^api/(?P&lt;username&gt;\w+)/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">entry_resource</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="toc.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tastypie Cookbook</a><ul>
<li><a class="reference internal" href="#adding-custom-values">Adding Custom Values</a></li>
<li><a class="reference internal" href="#using-your-resource-in-regular-views">Using Your <tt class="docutils literal"><span class="pre">Resource</span></tt> In Regular Views</a></li>
<li><a class="reference internal" href="#using-non-pk-data-for-your-urls">Using Non-PK Data For Your URLs</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="throttling.html"
                        title="previous chapter">Throttling</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="debugging.html"
                        title="next chapter">Debugging Tastypie</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/cookbook.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="debugging.html" title="Debugging Tastypie"
             >next</a> |</li>
        <li class="right" >
          <a href="throttling.html" title="Throttling"
             >previous</a> |</li>
        <li><a href="toc.html">Tastypie v0.9.7-beta documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, Daniel Lindsley, Cody Soyland &amp; Matt Croydon.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>
  </body>
</html>